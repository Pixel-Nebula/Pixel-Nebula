<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no"/>

    <title>PixelNebula</title>

    <link rel="stylesheet" href="assets/app.css" type="text/css"/>
    <link rel="icon" href="../../Pictures/Logo.png"/>
</head>
<body onload="checkLoginStatus()">
<div id="gameContainer"></div>
<div id="gui"></div>

<script type="text/javascript">
    var gameName = "cubefield.min.js";

    //This all here is for cache busting;
    function addScript(src, buster, callback) {
        var s = document.createElement('script');
        s.setAttribute('src', src + '?v=' + buster);
        if (typeof callback === 'function') {
            s.onload = callback;
        }
        document.body.appendChild(s);
    }

    addScript('version.js', Date.now(), function () {
        addScript(gameName, version, function () {
            /**
             * Here we create the game
             */
            ga = () => {};
        })
    })
</script>
    <script src="/js/main.js"></script>
    <script>
        function checkLoginStatus() {
    const cookies = document.cookie.split(';').reduce((acc, cookie) => {
        const [key, value] = cookie.split('=').map(c => c.trim());
        acc[key] = value;
        return acc;
    }, {});
    
    const idToken = cookies.IDToken;
    
    if (idToken) {
        fetch(`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${idToken}`)
            .then(response => response.json())
            .then(data => {})
            .catch(error => {
                console.error('Error validating token:', error);
                // Clear the cookie and redirect to index.html if token validation fails
                document.cookie = "IDToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
                window.location.href = '../../index.html';
            });
    } else {
        // Redirect to index.html if no ID Token is found
        window.location.href = '../../index.html';
    }
    }
    </script>

</body>
</html>
